<html>

<head>
  <title>Beleza Soft - Lista de Agendamentos</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
  <link href="style.css" rel="stylesheet" />

</head>

<body>
  <h1 class="center-align pink-text text-darken-2">Lista de Agendamentos</h1>
  <table class="highlight" >
    <thead>
      <tr>
        <!-- <th>Id</th> -->
        <th>Nome</th>
        <th>Data</th>
        <th>Situac√£o</th>

      </tr>
    </thead>
    <tbody id="tblAgendamento"></tbody>
  </table>
  <br />
  <br />
  <input class="btn dropdown-trigger waves-effect waves-light pink" type="button" value="Novo" onclick="novo();" />
  <input class="btn dropdown-trigger waves-effect waves-light pink" type="button" value="Voltar" onclick="window.location.replace('index.html');" />
  <script src="./global.js"></script>
</body>

</html>
<script>


  window.onload = function () {
    listar();
  };

  function novo() {
    window.location.href = "managendamento.html";
  }

  function editar(id) {
    window.location.href = "managendamento.html?id=" + id;
  }

  async function listar() {
    await fetch(url + "listagendamentos", {
      method: "GET",
      headers: {
        "Content-Type": "application/json",
      },
    }).then((response) => {
      if (response.ok) {
        response.json().then((data) => {
          var tblAgendamento = document.getElementById("tblAgendamento");
          tblAgendamento.innerHTML = "";
          for (var i = 0; i < data.length; i++) {
            var linha = tblAgendamento.insertRow();
            var coluna1 = linha.insertCell(0);
            var coluna2 = linha.insertCell(1);
            var coluna3 = linha.insertCell(2);
            var coluna4 = linha.insertCell(3);

            const hoje = new Date()

            coluna1.innerHTML = data[i].nome;
            coluna2.innerHTML = hoje.toLocaleDateString();
            coluna3.innerHTML = "Pago";
            coluna4.innerHTML = '<button class="btn dropdown-trigger waves-effect waves-light pink" name="button" value="OK" type="button" onclick="editar(\'' +
              data[i]._id +
              "')\">Editar</button>";;
              
          }
        });
      } else {
        window.alert("Erro ao agendar cliente");
      }
    });
  }
</script>